<form id="payment-form">
  <input type="text" name="username" placeholder="Name" required /><br />
  <input type="email" name="email" placeholder="Email" required /><br />
  <input
    type="number"
    name="amount"
    placeholder="Amount (GBP)"
    step="0.01"
    required
  /><br />
  <button type="submit">Pay Now</button>
</form>

<!-- Load Stripe.js -->
<script src="https://js.stripe.com/v3/"></script>
<script>
  const stripe = Stripe(
    "pk_live_51Rpsq2LRwcoOq8wgsLstZO5LcuIqjk7M54Kisklu5AbUHZfeC1r1RDaEA6bz7iq6eDxFiR7yqLGrx80PsGYmdqGt007D5oIJL3"
  ); // <-- Use Site B's PUBLIC key

  document
    .getElementById("payment-form")
    .addEventListener("submit", async (e) => {
      e.preventDefault();

      const username = e.target.username.value;
      const email = e.target.email.value;
      const amount = parseFloat(e.target.amount.value);

      // ✅ Build cartItems array to match Site B’s expectation
      const cartItems = [
        {
          name: `Payment from ${username}`,
          price: amount,
          quantity: 1,
          image: "", // optional
        },
      ];

      try {
        // ✅ Send to Site B
        const response = await fetch(
          "https://backendroutes-lcpt.onrender.com/create-checkout-session",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ cartItems }),
          }
        );

        const data = await response.json();

        if (!data.id) {
          alert("Failed to create payment session");
          return;
        }

        // ✅ Redirect to Stripe Checkout
        const result = await stripe.redirectToCheckout({ sessionId: data.id });
        if (result.error) {
          console.error(result.error.message);
          alert("Unable to redirect to payment page");
        }
      } catch (err) {
        console.error("Error:", err);
        alert("Server error");
      }
    });
</script>
